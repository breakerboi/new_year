<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–†–£–¢–ê–Ø –ò–ì–†–ê</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            gap: 30px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            min-width: 120px;
        }
        
        .status-label {
            font-size: 12px;
            color: #6c757d;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        button {
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: #3498db;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        button.round {
            background: #27ae60;
        }
        
        button.reset {
            background: #e74c3c;
        }
        
        .round-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .question-display {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        #currentQuestionText {
            font-size: 20px;
            margin: 0 0 20px 0;
            min-height: 60px;
        }
        
        .answers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .answers {
                grid-template-columns: 1fr;
            }
        }
        
        .answer {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .answer.correct {
            border-color: #27ae60;
            background: #d4edda;
        }
        
        .answer-letter {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .meme-image-container {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .meme-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .participants-container {
            margin-top: 30px;
        }
        
        .participants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .all-answered-badge {
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
        }
        
        .all-answered-badge.show {
            display: inline-block;
        }
        
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (max-width: 1200px) {
            .participants-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .participants-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .participant {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 3px solid transparent;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .participant.answered {
            border-color: #27ae60;
            background: #d4edda;
        }
        
        .participant-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .answers-stats {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            display: none;
        }
        
        .answers-stats.show {
            display: block;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .stats-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
        }
        
        .stats-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .stats-table tr:hover {
            background: #f8f9fa;
        }
        
        .add-score-btn {
            padding: 5px 10px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-score-btn:hover {
            background: #219653;
        }
        
        .round-statistics {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .round-statistics.show {
            display: block;
        }
        
        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .statistics-table th {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .statistics-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .statistics-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .notification.error {
            border-left-color: #e74c3c;
        }
        
        .notification.error i {
            color: #e74c3c;
        }
        
        .telegram-info {
            background: #0088cc;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .online {
            color: #27ae60;
        }
        
        .offline {
            color: #e74c3c;
        }
        
        .admin-controls {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .score-control {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .score-input {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 60px;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ç–∏–ª–∏ */
        .admin-controls {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
        }

        .admin-controls.visible {
            display: block;
        }

        .video-controls {
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .video-controls.visible {
            display: block;
        }

        .watch-video-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #FF006E 0%, #8338EC 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
        }

        .watch-video-btn:hover {
            background: linear-gradient(135deg, #E60063 0%, #6A2AC9 100%);
            transform: translateY(-2px);
        }
        
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #2980b9;
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-gamepad"></i> –ö–†–£–¢–ê–Ø –ò–ì–†–ê</h1>
        
        <div class="telegram-info">
            <i class="fab fa-telegram"></i> Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω! 
            –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</span>
                <span id="status" class="status-value offline">–û—Ç–∫–ª—é—á–µ–Ω–æ</span>
            </div>
            <div class="status-item">
                <span class="status-label">–¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥:</span>
                <span id="currentRound" class="status-value">–†–∞–∑–º–∏–Ω–û–ß–ö–ê</span>
            </div>
            <div class="status-item">
                <span class="status-label">–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å:</span>
                <span id="currentQuestionNumber" class="status-value">1/12</span>
            </div>
            <div class="status-item">
                <span class="status-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</span>
                <span id="participantsCount" class="status-value">0</span>
            </div>
        </div>
        
        <div class="round-controls">
            <button id="switchRound1" class="round">
                <i class="fas fa-brain"></i> –†–∞–∑–º–∏–Ω–û–ß–ö–ê
            </button>
            <button id="switchRound2" class="round">
                <i class="fas fa-image"></i> –ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê
            </button>
        </div>
        
        <div class="controls">
            <button id="prevQuestion">
                <i class="fas fa-arrow-left"></i> –ü—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å
            </button>
            <button id="nextQuestion">
                <i class="fas fa-arrow-right"></i> –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
            </button>
            <button id="showAnswers">
                <i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
            </button>
            <button id="resetRound" class="reset">
                <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—É–Ω–¥
            </button>
        </div>
        
        <div class="question-display">
            <h3 id="currentQuestionText">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...</h3>
            <div id="memeImageContainer" class="meme-image-container">
                <img id="memeImage" class="meme-image" src="" alt="–ú–µ–º">
            </div>
            <div id="answersContainer" class="answers">
                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <div id="videoControls" class="video-controls">
            <button id="watchVideoBtn" class="watch-video-btn">
                <i class="fas fa-video"></i> –°–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ
            </button>
        </div>
        
        <div class="participants-container">
            <div class="participants-header">
                <h3><i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <div id="allAnsweredBadge" class="all-answered-badge">
                    <i class="fas fa-check-circle"></i> –í—Å–µ –æ—Ç–≤–µ—Ç–∏–ª–∏
                </div>
            </div>
            <div id="participantsGrid" class="participants-grid">
                <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <div class="answers-stats" id="answersStats">
            <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤</h3>
            <div id="statsContainer">
                <p>–û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...</p>
            </div>
        </div>
        
        <!-- –í –±–ª–æ–∫–µ round-statistics -->
        <div class="round-statistics" id="roundStatistics">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3><i class="fas fa-trophy"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–∞</h3>
                <button id="refreshStatsBtn" class="refresh-btn" title="–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div id="statisticsContainer">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <div id="adminControls" class="admin-controls">
            <h4><i class="fas fa-user-shield"></i> –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤</h4>
            <div class="score-control">
                <select id="participantSelect">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                </select>
                <input type="number" id="scoreInput" class="score-input" value="1" min="1" max="10">
                <button id="addScoreBtn">
                    <i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –±–∞–ª–ª—ã
                </button>
            </div>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">
                <i class="fas fa-info-circle"></i> –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞ "–ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê"
            </p>
        </div>
    </div>
    
    <div id="notification" class="notification">
        <i class="fas fa-bell"></i>
        <span id="notificationText">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
    </div>
    
    <!-- Socket.io –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        class QuizClient {
            constructor() {
                this.socket = null;
                this.currentRound = 1;
                this.currentQuestion = 0;
                this.participants = [];
                this.answers = {};
                this.scores = {};
                this.showAnswers = false;
                this.statsVisible = false;
                this.allAnswered = false;

                this.questions = {
                    round1: [],
                    round2: []
                };

                // –î–û–ë–ê–í–¨–¢–ï –≠–¢–ò –°–í–û–ô–°–¢–í–ê:
                this.currentQuestionVideoShown = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞ –≤–∏–¥–µ–æ
                this.currentQuestionVideoUrl = null; // URL –≤–∏–¥–µ–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                this.roundStatistics = null; // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–∞
                this.isLastQuestionReached = false; // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

                this.init();

            }
            
            init() {
                this.connectWebSocket();
                this.setupEventListeners();
                this.setupKeyboardShortcuts();
            }
            
            connectWebSocket() {
                this.socket = io();
                
                this.socket.on('connect', () => {
                    console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
                    this.updateStatus('online', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                    this.showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
                });
                
                this.socket.on('connect_error', (error) => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                    this.updateStatus('offline', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                });
                
                this.socket.on('disconnect', () => {
                    console.log('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                    this.updateStatus('offline', '–û—Ç–∫–ª—é—á–µ–Ω–æ');
                });
                
                this.socket.on('gameState', (data) => {
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:', data);
                    if (data && data.data) {
                        this.updateGameState(data.data);
                        // –ï—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–∞ —É–∂–µ –±—ã–ª–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –∏ –ø—Ä–∏—à–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ,
                        // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        if (this.roundStatistics && document.getElementById('roundStatistics').classList.contains('show')) {
                            this.showRoundStatistics(this.roundStatistics);
                        }
                    }
                });
                
                this.socket.on('newParticipant', (data) => {
                    console.log('–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫:', data);
                    this.addParticipant(data);
                    this.showNotification(`–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫: ${data.name}`);
                });
                
                this.socket.on('newAnswer', (data) => {
                    console.log('–ù–æ–≤—ã–π –æ—Ç–≤–µ—Ç:', data);
                    this.processAnswer(data);
                    
                    const answerLetters = ['A', 'B', 'C', 'D'];
                    const answerText = data.round === 1 ? 
                        `–û—Ç–≤–µ—Ç ${answerLetters[data.answer] || data.answer}` : 
                        `–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç`;
                    
                    this.showNotification(`${data.userName}: ${answerText}`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏
                    this.checkAllAnswered();
                });
                
                this.socket.on('roundStatistics', (data) => {
                    console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–∞:', data);
                    this.roundStatistics = data.data;
                    this.showRoundStatistics(data.data);
                });
                
                this.socket.on('error', (data) => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                    if (data.message === '–ù–µ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å') {
                        alert('–ù–µ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å!');
                    }
                });
            }
            
            updateGameState(state) {
                this.currentRound = state.currentRound || 1;
                this.currentQuestion = state.currentQuestion || 0;
                this.participants = state.participants ? Object.values(state.participants).filter(p => p.registered) : [];
                this.answers = state.answers || {};
                this.scores = state.scores || {};
                this.showAnswers = state.showAnswers || false;
                this.statsVisible = state.showStats || false;
                this.roundStatistics = state.roundStatistics || null;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å
                const maxQuestions = this.currentRound === 1 ? 12 : 10;
                this.isLastQuestionReached = (this.currentQuestion === maxQuestions - 1) && this.showAnswers;
                
                if (state.questions) {
                    this.questions = state.questions;
                }
                
                this.updateUI();
            }
            
            updateUI() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const roundNames = { 1: '–†–∞–∑–º–∏–Ω–û–ß–ö–ê', 2: '–ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê' };
                document.getElementById('currentRound').textContent = roundNames[this.currentRound];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω—ã—Ö —Ä–∞—É–Ω–¥–æ–≤
                const maxQuestions = this.currentRound === 1 ? 12 : 10;
                document.getElementById('currentQuestionNumber').textContent = 
                    `${this.currentQuestion + 1}/${maxQuestions}`;
                
                document.getElementById('participantsCount').textContent = this.participants.length;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å
                this.updateQuestionDisplay();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                this.renderParticipants();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (this.statsVisible) {
                    this.updateStats();
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statsContainer = document.getElementById('answersStats');
                if (this.statsVisible && this.showAnswers) {
                    statsContainer.classList.add('show');
                } else {
                    statsContainer.classList.remove('show');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã"
                const showAnswersBtn = document.getElementById('showAnswers');
                if (this.showAnswers) {
                    showAnswersBtn.innerHTML = '<i class="fas fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã';
                } else {
                    showAnswersBtn.innerHTML = '<i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã';
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏
                this.checkAllAnswered();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤
                this.updateParticipantSelect();
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –±–ª–æ–∫–æ–≤
                this.updateControlsVisibility();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç—Ä–æ–ª—ã
                this.updateVideoControls();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—É–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –≤–æ–ø—Ä–æ—Å–µ —Å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
                const statisticsDiv = document.getElementById('roundStatistics');
                if (this.isLastQuestionReached && this.roundStatistics) {
                    statisticsDiv.classList.add('show');
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    this.showRoundStatistics(this.roundStatistics);
                } else {
                    statisticsDiv.classList.remove('show');
                }
            }

            // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é –±–ª–æ–∫–æ–≤
            updateControlsVisibility() {
                const adminControls = document.getElementById('adminControls');
                const roundStatistics = document.getElementById('roundStatistics');
                
                // –ë–ª–æ–∫ —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—É–Ω–¥–µ 2
                if (this.currentRound === 2) {
                    adminControls.classList.add('visible');
                } else {
                    adminControls.classList.remove('visible');
                }
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—É–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
                if (this.roundStatistics) {
                    roundStatistics.classList.add('show');
                } else {
                    roundStatistics.classList.remove('show');
                }
            }

            // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
            updateVideoControls() {
                const videoControls = document.getElementById('videoControls');
                const watchVideoBtn = document.getElementById('watchVideoBtn');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç—Ä–æ–ª—ã —Ç–æ–ª—å–∫–æ –≤–æ 2 —Ä–∞—É–Ω–¥–µ –∏ –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Ç–≤–µ—Ç—ã
                if (this.currentRound === 2 && this.showAnswers && !this.currentQuestionVideoShown) {
                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ —É —Å–µ—Ä–≤–µ—Ä–∞
                    this.socket.emit('getQuestionVideo', {
                        round: this.currentRound,
                        questionIndex: this.currentQuestion
                    }, (data) => {
                        if (data.videoUrl) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≤–∏–¥–µ–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                            this.currentQuestionVideoUrl = data.videoUrl;
                            videoControls.classList.add('visible');
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                            watchVideoBtn.onclick = () => {
                                this.watchVideo();
                            };
                        } else {
                            videoControls.classList.remove('visible');
                        }
                    });
                } else {
                    videoControls.classList.remove('visible');
                }
            }

            // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ
            watchVideo() {
                if (this.currentQuestionVideoUrl) {
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                    window.open(this.currentQuestionVideoUrl, '_blank');
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –≤–∏–¥–µ–æ –ø–æ–∫–∞–∑–∞–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                    this.currentQuestionVideoShown = true;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
                    document.getElementById('videoControls').classList.remove('visible');
                }
            }
            
            updateQuestionDisplay() {
                const roundKey = `round${this.currentRound}`;
                const question = this.questions[roundKey] ? 
                    this.questions[roundKey][this.currentQuestion] : null;
                
                const questionText = document.getElementById('currentQuestionText');
                const answersContainer = document.getElementById('answersContainer');
                const memeImageContainer = document.getElementById('memeImageContainer');
                const memeImage = document.getElementById('memeImage');
                
                if (question) {
                    if (this.currentRound === 1) {
                        // –†–∞—É–Ω–¥ 1: –†–∞–∑–º–∏–Ω–û–ß–ö–ê
                        questionText.textContent = question.text || `–í–æ–ø—Ä–æ—Å ${this.currentQuestion + 1}`;
                        memeImageContainer.style.display = 'none';
                        
                        let answersHTML = '';
                        const answerLetters = ['A', 'B', 'C', 'D'];
                        
                        question.answers.forEach((answer, index) => {
                            const isCorrect = this.showAnswers && index === question.correct;
                            answersHTML += `
                                <div class="answer ${isCorrect ? 'correct' : ''}">
                                    <span class="answer-letter">${answerLetters[index]}</span>
                                    ${answer}
                                    ${isCorrect ? ' <i class="fas fa-check" style="color: #27ae60;"></i>' : ''}
                                </div>
                            `;
                        });
                        
                        answersContainer.innerHTML = answersHTML;
                    } else {
                        // –†–∞—É–Ω–¥ 2: –ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê
                        questionText.textContent = question.text || `–ú–µ–º ${this.currentQuestion + 1}`;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        if (question.imageUrl) {
                            memeImage.src = question.imageUrl;
                            memeImageContainer.style.display = 'block';
                        } else {
                            memeImageContainer.style.display = 'none';
                        }
                        
                        // –î–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                        answersContainer.innerHTML = `
                            <div style="grid-column: span 2; text-align: center; padding: 40px;">
                                <i class="fas fa-image fa-4x" style="color: #3498db; margin-bottom: 20px;"></i>
                                <p><strong>–†–∞—É–Ω–¥ "–ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê"</strong></p>
                                <p>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</p>
                                ${this.showAnswers && question.memeName ? 
                                    `<p style="margin-top: 20px; color: #27ae60; font-weight: bold;">
                                        <i class="fas fa-lightbulb"></i> –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${question.memeName}
                                    </p>` : ''
                                }
                            </div>
                        `;
                    }
                } else {
                    questionText.textContent = '–í–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    answersContainer.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...</p>';
                }
            }
            
            renderParticipants() {
                const container = document.getElementById('participantsGrid');
                let participantsHTML = '';
                
                this.participants.forEach(participant => {
                    const answered = this.hasParticipantAnswered(participant);
                    
                    participantsHTML += `
                        <div class="participant ${answered ? 'answered' : ''}">
                            <!-- –£–±—Ä–∞–Ω participant-score -->
                            <div class="participant-circle" style="background: ${participant.color || '#3498db'}">
                                ${participant.name ? participant.name.charAt(0).toUpperCase() : '?'}
                            </div>
                            <div><strong>${participant.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</strong></div>
                            <small style="color: ${answered ? '#27ae60' : '#666'}">
                                ${answered ? '‚úì –û—Ç–≤–µ—Ç–∏–ª' : '–û–∂–∏–¥–∞–µ—Ç'}
                            </small>
                        </div>
                    `;
                });
                
                container.innerHTML = participantsHTML || '<p>–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>';
            }
            
            hasParticipantAnswered(participant) {
                const answerId = `${this.currentRound}_${this.currentQuestion}`;
                return this.answers[answerId] && 
                    Object.values(this.answers[answerId]).some(answer => 
                        answer.userName === participant.name);
            }
            
            checkAllAnswered() {
                const answerId = `${this.currentRound}_${this.currentQuestion}`;
                const currentAnswers = this.answers[answerId] || {};
                const participantsCount = this.participants.length;
                const answeredCount = Object.keys(currentAnswers).length;
                
                this.allAnswered = participantsCount > 0 && answeredCount >= participantsCount;
                
                const badge = document.getElementById('allAnsweredBadge');
                if (this.allAnswered && participantsCount > 0) {
                    badge.classList.add('show');
                } else {
                    badge.classList.remove('show');
                }
                
                return this.allAnswered;
            }

            updateStats() {
                const container = document.getElementById('statsContainer');
                const answerId = `${this.currentRound}_${this.currentQuestion}`;
                const currentAnswers = this.answers[answerId] || {};
                
                const answersArray = Object.values(currentAnswers);
                
                if (answersArray.length === 0) {
                    container.innerHTML = '<p>–û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...</p>';
                    return;
                }
                
                // –î–ª—è —Ä–∞—É–Ω–¥–∞ 2 - —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫ –∏ –æ—Ç–≤–µ—Ç
                if (this.currentRound === 2) {
                    let statsHTML = `
                        <p>–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: <strong>${answersArray.length}/${this.participants.length}</strong></p>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                                    <th>–û—Ç–≤–µ—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    answersArray.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))
                        .forEach(answer => {
                            statsHTML += `
                                <tr>
                                    <td><strong>${answer.userName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</strong></td>
                                    <td>${answer.answer}</td>
                                </tr>
                            `;
                        });
                    
                    statsHTML += `
                            </tbody>
                        </table>
                    `;
                    
                    container.innerHTML = statsHTML;
                } else {
                    // –î–ª—è —Ä–∞—É–Ω–¥–∞ 1 - —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞
                    let statsHTML = `
                        <p>–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: <strong>${answersArray.length}/${this.participants.length}</strong></p>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                                    <th>–û—Ç–≤–µ—Ç</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    const answerLetters = ['A', 'B', 'C', 'D'];
                    
                    answersArray.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))
                        .forEach(answer => {
                            statsHTML += `
                                <tr>
                                    <td><strong>${answer.userName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</strong></td>
                                    <td>${answerLetters[answer.answer] || answer.answer}</td>
                                    <td>
                                        <span style="color: ${answer.isCorrect ? '#27ae60' : '#e74c3c'}">
                                            ${answer.isCorrect ? '‚úÖ –í–µ—Ä–Ω–æ' : '‚ùå –ù–µ–≤–µ—Ä–Ω–æ'}
                                        </span>
                                    </td>
                                </tr>
                            `;
                        });
                    
                    statsHTML += `
                            </tbody>
                        </table>
                    `;
                    
                    container.innerHTML = statsHTML;
                }
            }
            
            addParticipant(data) {
                const existingIndex = this.participants.findIndex(p => 
                    p.name === data.name);
                
                if (existingIndex === -1) {
                    this.participants.push({
                        userId: data.userId,
                        name: data.name,
                        color: data.color || this.getRandomColor()
                    });
                    
                    this.renderParticipants();
                    this.updateParticipantSelect();
                }
            }
            
            updateParticipantSelect() {
                const select = document.getElementById('participantSelect');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>';
                
                this.participants.forEach(participant => {
                    const userId = Object.keys(this.participants).find(key => 
                        this.participants[key] && this.participants[key].name === participant.name);
                    
                    if (userId) {
                        const option = document.createElement('option');
                        option.value = userId;
                        option.textContent = participant.name; // –¢–æ–ª—å–∫–æ –∏–º—è
                        select.appendChild(option);
                    }
                });
            }
            
            processAnswer(data) {
                const answerId = data.answerId || `${this.currentRound}_${this.currentQuestion}`;
                
                if (!this.answers[answerId]) {
                    this.answers[answerId] = {};
                }
                
                this.answers[answerId][data.userId] = {
                    answer: data.answer,
                    isCorrect: data.isCorrect,
                    userName: data.userName,
                    timestamp: data.timestamp || new Date().toISOString(),
                    round: data.round
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                this.renderParticipants();
                if (this.statsVisible) {
                    this.updateStats();
                }
                this.checkAllAnswered();
            }
            
            addManualScore(userId) {
                const points = prompt('–°–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É?', '1');
                if (points && !isNaN(parseInt(points)) && parseInt(points) > 0) {
                    this.socket.emit('addScore', { userId, points: parseInt(points) });
                    this.showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${points} –±–∞–ª–ª–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫—É`);
                }
            }
            
            showRoundStatistics(results) {
                const container = document.getElementById('statisticsContainer');
                const statisticsDiv = document.getElementById('roundStatistics');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å
                const maxQuestions = this.currentRound === 1 ? 12 : 10;
                if (this.currentQuestion !== maxQuestions - 1 || !this.showAnswers) {
                    statisticsDiv.classList.remove('show');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                statisticsDiv.classList.add('show');
                
                let statisticsHTML = `
                    <p>–ò—Ç–æ–≥–∏ —Ä–∞—É–Ω–¥–∞ "${this.currentRound === 1 ? '–†–∞–∑–º–∏–Ω–û–ß–ö–ê' : '–ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê'}":</p>
                    <table class="statistics-table">
                        <thead>
                            <tr>
                                <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                                <th>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</th>
                                <th>–ë–∞–ª–ª—ã –∑–∞ —Ä–∞—É–Ω–¥</th>
                                <th>–û–±—â–∏–π –±–∞–ª–ª</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                const participantsArray = Object.keys(results).map(userId => {
                    const participantData = results[userId];
                    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    const participantScore = this.scores[userId] || { total: 0, round1: 0, round2: 0 };
                    
                    return {
                        name: participantData.name,
                        correctAnswers: participantData.correctAnswers || 0,
                        totalAnswers: participantData.totalAnswers || 0,
                        roundScore: this.currentRound === 1 ? 
                            (participantScore.round1 || 0) : 
                            (participantScore.round2 || 0),
                        totalScore: participantScore.total || 0,
                        userId: userId
                    };
                });
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –±–∞–ª–ª—É
                participantsArray.sort((a, b) => b.totalScore - a.totalScore);
                
                participantsArray.forEach((participant, index) => {
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                    
                    statisticsHTML += `
                        <tr>
                            <td><strong>${medal} ${participant.name}</strong></td>
                            <td>${participant.correctAnswers}/${participant.totalAnswers}</td>
                            <td><strong>${participant.roundScore}</strong></td>
                            <td><strong style="color: #27ae60">${participant.totalScore}</strong></td>
                        </tr>
                    `;
                });
                
                statisticsHTML += `
                        </tbody>
                    </table>
                `;
                
                container.innerHTML = statisticsHTML;
            }
            
            getRandomColor() {
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0',
                    '#118AB2', '#7209B7', '#3A86FF', '#FB5607'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            sendCommand(command, data = {}) {
                if (this.socket && this.socket.connected) {
                    this.socket.emit(command, data);
                    console.log(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: ${command}`, data);
                } else {
                    console.error('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
                    this.showNotification('–û—à–∏–±–∫–∞: –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                }
            }
            
            setupEventListeners() {
                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('nextQuestion').addEventListener('click', () => {
                    this.sendCommand('nextQuestion');
                });
                
                document.getElementById('prevQuestion').addEventListener('click', () => {
                    this.sendCommand('prevQuestion');
                });
                
                document.getElementById('switchRound1').addEventListener('click', () => {
                    this.sendCommand('switchRound', { round: 1 });
                });
                
                document.getElementById('switchRound2').addEventListener('click', () => {
                    this.sendCommand('switchRound', { round: 2 });
                });
                
                // –í –º–µ—Ç–æ–¥–µ setupEventListeners –æ–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ showAnswers
                document.getElementById('showAnswers').addEventListener('click', () => {
                    if (this.showAnswers) {
                        this.sendCommand('hideAnswers');
                        document.getElementById('videoControls').classList.remove('visible');
                        this.currentQuestionVideoShown = false;
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏
                        if (!this.checkAllAnswered()) {
                            alert('–ù–µ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å!');
                            return;
                        }
                        
                        this.sendCommand('showAnswers');
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                        const maxQuestions = this.currentRound === 1 ? 12 : 10;
                        if (this.currentQuestion === maxQuestions - 1) {
                            // –§–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ gameState
                        }
                    }
                });
                
                document.getElementById('resetRound').addEventListener('click', () => {
                    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥? –í–°–ï —É—á–∞—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã, –±–∞–ª–ª—ã —Å–±—Ä–æ—à–µ–Ω—ã.')) {
                        this.sendCommand('resetRound');
                    }
                });
                
                document.getElementById('addScoreBtn').addEventListener('click', () => {
                    const participantSelect = document.getElementById('participantSelect');
                    const scoreInput = document.getElementById('scoreInput');
                    
                    const userId = participantSelect.value;
                    const points = parseInt(scoreInput.value) || 1;
                    
                    if (!userId) {
                        alert('–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞');
                        return;
                    }
                    
                    if (this.currentRound !== 2) {
                        alert('–†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—É–Ω–¥–∞ "–ö–∞—Ä—Ç–∏–Ω–û–ß–ö–ê"');
                        return;
                    }
                    
                    this.socket.emit('addScore', { userId, points });
                    this.showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${points} –±–∞–ª–ª–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫—É`);
                });

                document.getElementById('showAnswers').addEventListener('click', () => {
                    if (this.showAnswers) {
                        // –ï—Å–ª–∏ —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã, —Å–∫—Ä—ã–≤–∞–µ–º –∏—Ö
                        this.sendCommand('hideAnswers');
                        // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç—Ä–æ–ª—ã
                        document.getElementById('videoControls').classList.remove('visible');
                        this.currentQuestionVideoShown = false;
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏
                        if (!this.checkAllAnswered()) {
                            alert('–ù–µ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å!');
                            return;
                        }
                        
                        // –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—É–Ω–¥–∞
                        const maxQuestions = this.currentRound === 1 ? 12 : 10;
                        const isLastQuestion = this.currentQuestion === maxQuestions - 1;
                        
                        if (isLastQuestion) {
                            this.sendCommand('showAnswers');
                            // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                        } else {
                            this.sendCommand('showAnswers');
                        }
                    }
                });
                document.getElementById('refreshStatsBtn').addEventListener('click', () => {
                    if (this.roundStatistics) {
                        this.showRoundStatistics(this.roundStatistics);
                        this.showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                    }
                });
                document.getElementById('refreshStatsBtn').addEventListener('click', () => {
                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
                    if (this.roundStatistics && this.isLastQuestionReached) {
                        // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        this.socket.emit('refreshStatistics');
                        this.showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è...');
                    }
                });
            }
            
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        return;
                    }
                    
                    switch(e.key) {
                        case 'ArrowRight':
                        case ' ':
                            e.preventDefault();
                            this.sendCommand('nextQuestion');
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.sendCommand('prevQuestion');
                            break;
                        case '1':
                            this.sendCommand('switchRound', { round: 1 });
                            break;
                        case '2':
                            this.sendCommand('switchRound', { round: 2 });
                            break;
                        case 'a':
                            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–æ–≤
                            const showAnswersBtn = document.getElementById('showAnswers');
                            if (showAnswersBtn) showAnswersBtn.click();
                            break;
                    }
                });
            }
            
            updateStatus(status, text) {
                const statusElement = document.getElementById('status');
                statusElement.textContent = text;
                statusElement.className = `status-value ${status}`;
            }
            
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const textElement = document.getElementById('notificationText');
                
                textElement.textContent = message;
                
                const colors = {
                    info: '#3498db',
                    success: '#27ae60',
                    warning: '#f39c12',
                    error: '#e74c3c'
                };
                
                notification.style.borderLeftColor = colors[type] || colors.info;
                notification.className = `notification ${type === 'error' ? 'error' : ''}`;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            window.quizClient = new QuizClient();
        });
    </script>
</body>
</html>